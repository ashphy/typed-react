---
sidebar_position: 2
---

import React from 'react';

# ユニオン型

タスク管理アプリで、タスクのステータスを表示するバッジコンポーネントを作ってみましょう。

export function StatusBadgeString({ status }) {
  let label = "";
  let color = "";
  if (status === "todo") {
    label = "未着手";
    color = "gray";
  } else if (status === "in-progress") {
    label = "進行中";
    color = "blue";
  } else if (status === "done") {
    label = "完了";
    color = "green";
  } else if (status === "archived") {
    label = "アーカイブ済み";
    color = "purple";
  }
  return (
    <span style={{
      color,
      padding: "4px 8px",
      borderRadius: "4px",
      backgroundColor: "#f0f0f0",
      border: `1px solid ${color}`,
      display: "inline-block",
      fontSize: "0.875rem",
      fontWeight: 500
    }}>
      {label}
    </span>
  );
}

<div style={{ display: "flex", gap: "8px", padding: "16px", backgroundColor: "#fafafa", borderRadius: "8px", marginBottom: "16px" }}>
  <StatusBadgeString status="todo" />
  <StatusBadgeString status="in-progress" />
  <StatusBadgeString status="done" />
  <StatusBadgeString status="archived" />
</div>

### コード

[TypeScript Playground で開く](https://www.typescriptlang.org/play/?#code/JYWwDg9gTgLgBAJQKYEMDG8BmUIjgcilQ3wChTgA7GJKTdJOAZRhRgFcBnAIRQBMA5kgAKOMJzgBvUnDidWHTgC45MKFQEBuUgF9ymdpQzAIlZgq69BSABSTVbLnB0qWjnvyGiI4gJRSZOAAbJHgglAAjJCC4AF44ACIE7VkQ+DQIIOg4xOTyWWBMOBt5dzjY+ISYCD4IBP9pWVTI6JyEwCpzQAF3QGkjPKa4DKyoNoEoFABPPuc4aM5GQuLSxXLKqgBaMBxRpE5OeoD+8KiYysAmBMAZCMBaOSnZQezKiKD2JCmdGaC5uAWSiwkKytqlBeDUCzWObUAMdqAMLkbgNMvdEtskJRXu9Pt8lk5-okUFA0AALYAANyQfH2jSaR1alUARQyAH4ZANUMgBKGQBrDIAIO0A-gywu7DSpgdhQMAhV75OBEDhQMw2UFwAA8nDAKDM8nGIViknsPIANHBFXw+BoVAkACxgAAecAAHOaEjqItA+LQEPxgFwjaazQlnDoAHwy2SSKlBPT9WUAegVSr9sl82j0FGotHoaEYABUUJwANYHL58FSUdggKJQFJwGDAGAhFTydSULSBTHKVS1+vxgxGcumODprMAGWA8hsINupnkZYzmabPczAG0ALo5Gcy+zAPNwACMOvLlaQRtT4zASCYaHUYBggCSGQBm2oA3BltDkURsBL2cWuXuZUACYtxWq4lkOgLxvO9GyNdZNggbZdi9HRX36Fc1wAZm-HcjRpQB1hkAK4Zz0AHXlAGiGYDfiNapamg2C4DnbRAnFAUpRlWV2CCaN+ikVgs04AA6EAUDAGwbFYzN-FiH1in9JpZSCYA4EzJBxnVfj2NXX1RLg+TtxCN5ZTcRQrCEe8uDkid2MbN4wyY5i5TDCSzKaXxfBDMSwwYpjY10IA)

```tsx
interface Task {
  id: number;
  title: string;
  status: string;
}

interface StatusBadgeProps {
  status: string;
}

function StatusBadge({ status }: StatusBadgeProps) {
  let label = "";
  let color = "";

  if (status === "todo") {
    label = "未着手";
    color = "gray";
  } else if (status === "in-progress") {
    label = "進行中";
    color = "blue";
  } else if (status === "done") {
    label = "完了";
    color = "green";
  } else if (status === "archived") {
    label = "アーカイブ済み";
    color = "purple";
  }

  return (
    <span style={{ color, padding: "4px 8px", borderRadius: "4px" }}>
      {label}
    </span>
  );
}
```

### 使用例

```tsx
function TaskList() {
  const tasks: Task[] = [
    { id: 1, title: "TypeScriptを学ぶ", status: "done" },
    { id: 2, title: "Reactを学ぶ", status: "in-progress" },
    { id: 3, title: "アプリを作る", status: "todo" },
  ];

  return (
    <ul>
      {tasks.map((task) => (
        <li key={task.id}>
          {task.title} <StatusBadge status={task.status} />
        </li>
      ))}
    </ul>
  );
}
```

一見動きそうに見えますが、この実装にはいくつか問題があります。

## 問題点

### 1. タイポが検出されない

```tsx
const task: Task = {
  id: 1,
  title: "TypeScriptを学ぶ",
  status: "doen", // ❌ "done" のタイポだがコンパイルは通る
};
```

タイポがあってもコンパイルエラーにならず、実行時にバッジが空白で表示されてしまいます。

### 2. IDE の補完が効かない

`status` を入力するとき、どんな値が有効なのか IDE が教えてくれません。毎回、他のコードを見て確認する必要があります。

### 3. 不正な値を渡せてしまう

```tsx
const task: Task = {
  id: 2,
  title: "ドキュメントを書く",
  status: "完了", // ❌ 日本語でもコンパイルは通る
};

const task2: Task = {
  id: 3,
  title: "レビューする",
  status: "pending", // ❌ 未定義のステータスでもコンパイルは通る
};
```

`string` 型ではどんな文字列でも受け付けてしまうため、想定外の値が紛れ込む可能性があります。

### 4. すべてのステータスを網羅しているか分からない

新しいステータス `"blocked"` を追加したとき、`StatusBadge` コンポーネントの `if` 文を更新し忘れても、コンパイルエラーになりません。

## 解決:ユニオン型

### ユニオン型とは

[ユニオン型 (union type) | TypeScript入門『サバイバルTypeScript』](https://typescriptbook.jp/reference/values-types-variables/union)

ユニオン型は、複数の型のうち「いずれか1つ」を表す型です。`|` (パイプ記号) で型を区切って定義します。

```tsx
type StringOrNumber = string | number;

const value1: StringOrNumber = "hello"; // ✅ OK
const value2: StringOrNumber = 123; // ✅ OK
const value3: StringOrNumber = true; // ❌ エラー: boolean は許可されていない
```

### 文字列リテラル型

文字列リテラル型は、特定の文字列値だけを表す型です。

```tsx
type Todo = "todo";

const status1: Todo = "todo"; // ✅ OK
const status2: Todo = "done"; // ❌ エラー: "done" は許可されていない
```

### ユニオン型 + 文字列リテラル型

これらを組み合わせることで、**特定の文字列値のみを許可する型**を定義できます。

```tsx
type TaskStatus = "todo" | "in-progress" | "done" | "archived";

const status1: TaskStatus = "todo"; // ✅ OK
const status2: TaskStatus = "done"; // ✅ OK
const status3: TaskStatus = "doen"; // ❌ エラー: タイポが検出される
const status4: TaskStatus = "pending"; // ❌ エラー: 未定義の値は拒否される
```

これを使って、先ほどのコードを改善してみましょう。

### コード

```tsx
type TaskStatus = "todo" | "in-progress" | "done" | "archived";

interface Task {
  id: number;
  title: string;
  status: TaskStatus; // ✅ 4つの値のみ許可
}

interface StatusBadgeProps {
  status: TaskStatus;
}

function StatusBadge({ status }: StatusBadgeProps) {
  const label = {
    todo: "未着手",
    "in-progress": "進行中",
    done: "完了",
    archived: "アーカイブ済み",
  }[status];

  const color = {
    todo: "gray",
    "in-progress": "blue",
    done: "green",
    archived: "purple",
  }[status];

  return (
    <span style={{ color, padding: "4px 8px", borderRadius: "4px" }}>
      {label}
    </span>
  );
}
```

### 改善点

**1. タイポが即座に検出される**

```tsx
const task: Task = {
  id: 1,
  title: "TypeScriptを学ぶ",
  status: "doen", // ❌ エラー: "doen" は TaskStatus に含まれない
};
```

**2. 不正な値を渡せない**

```tsx
const task: Task = {
  id: 2,
  title: "ドキュメントを書く",
  status: "完了", // ❌ エラー: "完了" は TaskStatus に含まれない
};

const task2: Task = {
  id: 3,
  title: "レビューする",
  status: "pending", // ❌ エラー: "pending" は TaskStatus に含まれない
};
```

**3. IDE が補完してくれる**

`status: ` と入力すると、IDE が `"todo"`, `"in-progress"`, `"done"`, `"archived"` を候補として提示してくれます。

**4. 有効な値が一目瞭然**

型定義を見れば、どんな値が許可されているかすぐに分かります。

## まとめ

文字列リテラルのユニオン型を使うことで：

- **型安全性**: タイポや不正な値を防げる
- **補完**: IDE が有効な値を提示してくれる
- **可読性**: どんな値が許可されているか一目瞭然
- **保守性**: 値を追加・削除したとき、影響箇所がすぐ分かる

### いつ使うべきか

- 取りうる値が限定されている場合
- 値がプログラム内で決まっている場合（ユーザー入力ではない）
- 複数の箇所で同じ値のセットを使う場合

例:

- ステータス、状態
- ボタンのバリアント（`primary`, `secondary` など）
- サイズ（`sm`, `md`, `lg` など）
- 方向（`top`, `right`, `bottom`, `left` など）
